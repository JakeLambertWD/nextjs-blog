{"ast":null,"code":"import { MongoClient } from 'mongodb';\n\nasync function handler(req, res) {\n  if (req.method == 'POST') {\n    const {\n      email,\n      name,\n      message\n    } = req.body; // store in a database\n\n    const newMessage = {\n      email,\n      name,\n      message\n    }; // mongodb\n\n    let client; // connect to environment variables\n    // now you can access 'process.env.customKey' in your code\n\n    const connectionString = `mongodb+srv://${process.env.mongodb_username}:${process.env.mongodb_password}@${process.env.mongodb_clustername}.fwhyj.mongodb.net/${process.env.mongodb_database}?retryWrites=true&w=majority`;\n\n    try {\n      client = await MongoClient.connect('mongodb+srv://next-blog:euGcIa6KjnfxUAus@cluster0.fwhyj.mongodb.net/my-site?retryWrites=true&w=majority');\n    } catch (err) {\n      res.status(500).json({\n        message: 'Could not connect  to db'\n      });\n      return;\n    }\n\n    const db = client.db();\n\n    try {\n      const result = await db.collection('messages').insertOne(newMessage); // manually add the auto generated id from mongodb\n\n      newMessage.id = result.insertedId;\n    } catch (err) {\n      client.close();\n      res.status(500).json({\n        message: 'Storing msg failed'\n      });\n      return;\n    }\n\n    client.close();\n    res.status(201).json({\n      message: 'Success',\n      message: newMessage\n    });\n  }\n}\n\nexport default handler;","map":null,"metadata":{},"sourceType":"module"}